package com.gdufs.graduation;import java.io.IOException;import java.io.PrintWriter;import java.sql.Date;import java.util.ArrayList;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;@Controllerpublic class CreateGameController { final static String html=   "<head><link href='./static/css/bootstrap.min.css' rel='stylesheet'>"+    "<link href='./static/css/font-awesome.min.css' rel='stylesheet'>"+    "<link href='./static/css/font-face.css' rel='stylesheet'>"+    "<meta charset='utf-8' />"+    "<script type='text/javascript' src='./static/js/jquery-1.11.2.min.js'></script> "+      "<script src='./static/js/bootstrap.min.js'></script>"+     "<script src='./static/js/bootbox.min.js'></script></head>";  //去CreateGame页面 @RequestMapping(value = "/toCreateGame", method = RequestMethod.GET) public String toPlayerManage(HttpSession session,Model model) {  String userName = (String)session.getAttribute("userName");  if(userName!=null) {   return "CreateGame";  }  else {   return "LoginFirst";  } }  //ajax验证比赛名字是否重复 @RequestMapping(value = "/createGameCheckName", method = RequestMethod.POST) public void createGameCheckName(HttpServletRequest request, HttpServletResponse response, HttpSession session,Model model) throws IOException {  response.setContentType("text/html");  request.setCharacterEncoding("utf-8");     response.setCharacterEncoding("utf-8");          String gameName = request.getParameter("gameName").trim();     PrintWriter out = response.getWriter();     CreateGameDao check = new CreateGameDao();     boolean checkName = check.checkName(gameName);          if(checkName) {      out.print("true");     }     else {      out.print("false");     }          out.flush();  out.close(); }  //添加比赛 @RequestMapping(value = "/createGameDo", method = RequestMethod.POST) public void createGameCheckName(HttpServletRequest request, HttpServletResponse response, HttpSession session,Model model) throws IOException {  response.setContentType("text/html");  request.setCharacterEncoding("utf-8");     response.setCharacterEncoding("utf-8");          PrintWriter out = response.getWriter();     CreateGameDao check = new CreateGameDao();     String gameName = request.getParameter("gameName").trim();     Date startTime = Date.valueOf(request.getParameter("startTime").trim());     Date endTime = Date.valueOf(request.getParameter("endTime").trim());     String type = request.getParameter("type").trim();     String status = "比赛中";     int number = Integer.parseInt(request.getParameter("number").trim());          boolean checkName = check.checkName(gameName);     if(!checkName) {      out.print(html);     out.print("<body><script>bootbox.alert('<br><B>比赛名重复，请再试一次。',function (){window.history.go(-1);})</script></body>");     }     else {      boolean checkInsert = check.addGame(gameName, startTime, endTime, type, status, number);      if(checkInsert) {       out.print(html);      out.print("<body><script>bootbox.alert('<br><B>比赛创建成功。',function (){window.location.href='toGameManage';})</script></body>");      }      else {       out.print(html);      out.print("<body><script>bootbox.alert('<br><B>系统错误，请再试一次。',function (){window.history.go(-1);})</script></body>");      }     }          out.flush();  out.close(); }}
